<head>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>

<script>
function goback() {
	window.history.back();
}

function parse_json() {
try {
	var json = JSON.parse({{parsed_json|tojson}});
	var jsonpretty = JSON.stringify(json, undefined, 2);
	var labelpretty = document.getElementById("jsonpretty");
	labelpretty.innerHTML = jsonpretty;
	labelpretty.hidden = false;
	} catch (err) {
		
	}
	
}

function get_table() {
	request = new XMLHttpRequest();
	request.open("POST", "/getdomaintable", true);
	request.onreadystatechange = display_table;
	request.send(null);

}

function display_table() {
	if (request.readyState == 4 && request.status == 200) {
            unparsed_json = JSON.parse(request.responseText);
            var table = document.getElementById("domainTable");

            for (var i = 0; i < unparsed_json.length; i++) {
                var row = table.insertRow(i+1);
                var domain = row.insertCell(0);
                domain.innerHTML = unparsed_json[i].search_domain;

                var country = row.insertCell(1);
                country.innerHTML = unparsed_json[i].country;

                var server = row.insertCell(2);
                server.innerHTML = unparsed_json[i].whois_server;

                var state = row.insertCell(3);
                state.innerHTML = unparsed_json[i].state;

                var reg = row.insertCell(4);
                reg.innerHTML = unparsed_json[i].registrar;

                var org = row.insertCell(5);
                org.innerHTML = unparsed_json[i].org;

                var nameserver = row.insertCell(6);
                for (var j = 0; j < unparsed_json[i].name_servers.length; j++) {
                    nameserver.innerHTML = unparsed_json[i].name_servers[j]+'<br/>';
                }
                var emails = row.insertCell(7);
                for (var j = 0; j < unparsed_json[i].emails.length; j++) {
                    emails.innerHTML = unparsed_json[i].emails[j]+'<br/>';
                }

                var creationDate = row.insertCell(8);
                creationDate.innerHTML = unparsed_json[i].creation_date[0];

                var expirationDate = row.insertCell(9);
                expirationDate.innerHTML = unparsed_json[i].expiration_date[0];

            }


	}

}

window.onload = function(){
parse_json();
get_table();

};

</script>

<body>

<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand">Giant</a>
    </div>
    <ul class="nav navbar-nav">
      <li><a href="home.html">Home</a></li>
      <li><a href="displayip.html">Ip Info</a></li>
      <li class="active"><a href="displaydomain.html">Who Is</a></li>
      <li><a href="displaywhatis.html">What Is</a></li>
	  <li><a href="displayevent.html">Event</a></li>
    </ul>
  </div>
</nav>

<form action="/pywhois" method="post">
	<div class="container">
		<h1>Who Is</h1>
		<p>Enter a domain: <p>
		<input type="text" name="domain"><br>
		<button class="btn btn-default" type="submit">Submit</button>
	</div>
</form>

<pre hidden='hidden' id = "jsonpretty"></pre>
<div class="table-responsive">
<table id="domainTable" class="table">
    <tr>
        <th>Domain</th>
        <th>Country</th>
        <th>Who Is Server</th>
        <th>State</th>
        <th>Registrar</th>
        <th>Organization</th>
        <th>Name Servers</th>
        <th>Emails</th>
        <th>Creation Date</th>
        <th>Expiration Date</th>
    </tr>
</table>
    </div>
 
</body>